/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var m=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var x=(l,n)=>{for(var t in n)m(l,t,{get:n[t],enumerable:!0})},f=(l,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of w(n))!T.call(l,i)&&i!==t&&m(l,i,{get:()=>n[i],enumerable:!(e=v(n,i))||e.enumerable});return l};var H=l=>f(m({},"__esModule",{value:!0}),l);var L={};x(L,{default:()=>d});module.exports=H(L);var a=require("obsidian"),S={apiKey:"",model:"gemini-pro",targetLanguage:"\u65E5\u672C\u8A9E",translationHistory:[]},g="gemini-translate-view",u=class extends a.ItemView{constructor(t,e){super(t);this.plugin=e}getViewType(){return g}getDisplayText(){return"Gemini\u7FFB\u8A33"}getIcon(){return"languages"}async onOpen(){this.contentEl=this.containerEl.children[1],this.contentEl.empty();let t=this.contentEl.createEl("div",{cls:"gemini-translate-header"});t.createEl("h4",{text:"Gemini\u7FFB\u8A33"}),t.createEl("button",{text:"\u5C65\u6B74\u3092\u30AF\u30EA\u30A2",cls:"gemini-translate-clear-button"}).addEventListener("click",()=>{this.clearHistory()});let i=this.contentEl.createEl("div",{cls:"gemini-translate-input-area"}),s=i.createEl("textarea",{cls:"gemini-translate-input",attr:{placeholder:"\u7FFB\u8A33\u3057\u305F\u3044\u30C6\u30AD\u30B9\u30C8\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044...",rows:"3"}});i.createEl("button",{text:"\u7FFB\u8A33",cls:"gemini-translate-button"}).addEventListener("click",async()=>{let c=s.value.trim();c&&(await this.plugin.translateText(c),s.value="")}),s.addEventListener("keydown",async c=>{if(c.key==="Enter"&&!c.shiftKey){c.preventDefault();let p=s.value.trim();p&&(await this.plugin.translateText(p),s.value="")}});let r=this.contentEl.createEl("div",{cls:"gemini-translate-content"});this.translationHistory=r.createEl("div",{cls:"gemini-translate-history"}),await this.loadHistory()}async onClose(){}async displayTranslation(t,e){let i=this.translationHistory.querySelector(".initial-message");i&&i.remove();let s=this.translationHistory.createEl("div",{cls:"translation-item"}),o=new Date().toLocaleString();s.createEl("div",{cls:"translation-timestamp"}).createEl("span",{text:o});let c=s.createEl("div",{cls:"translation-section"});c.createEl("h5",{text:"\u539F\u6587:"});let p=c.createEl("div",{text:t,cls:"original-text user-select"}),E=s.createEl("div",{cls:"translation-section"});E.createEl("h5",{text:"\u7FFB\u8A33:"});let I=E.createEl("div",{text:e,cls:"translated-text user-select"});s.createEl("hr",{cls:"translation-separator"}),this.translationHistory.appendChild(s);let h=this.contentEl.querySelector(".gemini-translate-content");h&&(h.scrollTop=h.scrollHeight),await this.saveTranslationToHistory(t,e,o)}displayError(t){let e=this.translationHistory.querySelector(".initial-message");e&&e.remove();let i=this.translationHistory.createEl("div",{cls:"translation-item error-item"}),s=new Date().toLocaleString();i.createEl("div",{cls:"translation-timestamp"}).createEl("span",{text:s}),i.createEl("p",{text:`\u30A8\u30E9\u30FC: ${t}`,cls:"error-message"}),i.createEl("hr",{cls:"translation-separator"}),this.translationHistory.appendChild(i);let r=this.contentEl.querySelector(".gemini-translate-content");r&&(r.scrollTop=r.scrollHeight)}showLoading(){let t=this.translationHistory.createEl("div",{cls:"loading-indicator"});t.createEl("p",{text:"\u7FFB\u8A33\u4E2D...",cls:"loading-message"}),this.translationHistory.appendChild(t);let e=this.contentEl.querySelector(".gemini-translate-content");e&&(e.scrollTop=e.scrollHeight)}hideLoading(){let t=this.translationHistory.querySelector(".loading-indicator");t&&t.remove()}async clearHistory(){this.translationHistory.empty(),this.translationHistory.createEl("div",{cls:"initial-message"}).createEl("p",{text:"\u30C6\u30AD\u30B9\u30C8\u3092\u5165\u529B\u3057\u3066\u7FFB\u8A33\u30DC\u30BF\u30F3\u3092\u62BC\u3059\u304B\u3001\u30C6\u30AD\u30B9\u30C8\u3092\u9078\u629E\u3057\u3066\u53F3\u30AF\u30EA\u30C3\u30AF\u30E1\u30CB\u30E5\u30FC\u304B\u3089\u300CGemini\u3067\u7FFB\u8A33\u300D\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}),this.plugin.settings.translationHistory=[],await this.plugin.saveSettings()}async saveTranslationToHistory(t,e,i){let s={timestamp:i,originalText:t,translatedText:e};this.plugin.settings.translationHistory.push(s),await this.plugin.saveSettings()}async loadHistory(){let t=this.plugin.settings.translationHistory;if(t.length===0){this.translationHistory.createEl("div",{cls:"initial-message"}).createEl("p",{text:"\u30C6\u30AD\u30B9\u30C8\u3092\u5165\u529B\u3057\u3066\u7FFB\u8A33\u30DC\u30BF\u30F3\u3092\u62BC\u3059\u304B\u3001\u30C6\u30AD\u30B9\u30C8\u3092\u9078\u629E\u3057\u3066\u53F3\u30AF\u30EA\u30C3\u30AF\u30E1\u30CB\u30E5\u30FC\u304B\u3089\u300CGemini\u3067\u7FFB\u8A33\u300D\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044\u3002"});return}for(let e of t){let i=this.translationHistory.createEl("div",{cls:"translation-item"});i.createEl("div",{cls:"translation-timestamp"}).createEl("span",{text:e.timestamp});let o=i.createEl("div",{cls:"translation-section"});o.createEl("h5",{text:"\u539F\u6587:"}),o.createEl("div",{text:e.originalText,cls:"original-text user-select"});let r=i.createEl("div",{cls:"translation-section"});r.createEl("h5",{text:"\u7FFB\u8A33:"}),r.createEl("div",{text:e.translatedText,cls:"translated-text user-select"}),i.createEl("hr",{cls:"translation-separator"})}}},d=class extends a.Plugin{async onload(){await this.loadSettings(),this.registerView(g,t=>new u(t,this)),this.addRibbonIcon("languages","Gemini\u7FFB\u8A33\u30D1\u30CD\u30EB\u3092\u958B\u304F",()=>{this.activateView()}),this.registerEvent(this.app.workspace.on("editor-menu",(t,e,i)=>{let s=e.getSelection();s&&t.addItem(o=>{o.setTitle("Gemini\u3067\u7FFB\u8A33").setIcon("languages").onClick(async()=>{await this.translateText(s)})})})),this.addSettingTab(new y(this.app,this))}onunload(){this.app.workspace.detachLeavesOfType(g)}async loadSettings(){this.settings=Object.assign({},S,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:t}=this.app,e=null,i=t.getLeavesOfType(g);i.length>0?e=i[0]:(e=t.getRightLeaf(!1),e&&await e.setViewState({type:g,active:!0})),e&&t.revealLeaf(e)}async translateText(t){if(!this.settings.apiKey){new a.Notice("API\u30AD\u30FC\u304C\u8A2D\u5B9A\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002\u8A2D\u5B9A\u753B\u9762\u3067API\u30AD\u30FC\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\u3002");return}await this.activateView();let e=this.app.workspace.getLeavesOfType(g);if(e.length===0)return;let i=e[0].view;i.showLoading();try{let s=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${this.settings.model}:generateContent?key=${this.settings.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`\u6B21\u306E\u30C6\u30AD\u30B9\u30C8\u3092${this.settings.targetLanguage}\u306B\u7FFB\u8A33\u3057\u3066\u304F\u3060\u3055\u3044\u3002\u7FFB\u8A33\u306E\u307F\u3092\u8FD4\u3057\u3066\u304F\u3060\u3055\u3044\u3002\uFF5E\uFF5E\u3060\u3002\uFF5E\uFF5E\u3067\u3042\u308B\u3002\u3068\u3044\u3063\u305F\u6587\u4F53\u3067\u7FFB\u8A33\u3092\u884C\u3063\u3066\u304F\u3060\u3055\u3044\u3002

\u30C6\u30AD\u30B9\u30C8: ${t}`}]}]})});if(!s.ok)throw new Error(`API request failed: ${s.statusText}`);let r=(await s.json()).candidates[0].content.parts[0].text;i.hideLoading(),i.displayTranslation(t,r)}catch(s){console.error("Translation error:",s),i.hideLoading(),i.displayError(s.message),new a.Notice(`\u7FFB\u8A33\u30A8\u30E9\u30FC: ${s.message}`)}}},y=class extends a.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Gemini\u7FFB\u8A33\u8A2D\u5B9A"}),new a.Setting(t).setName("Gemini API Key").setDesc("Google AI Studio\u304B\u3089API\u30AD\u30FC\u3092\u53D6\u5F97\u3057\u3066\u304F\u3060\u3055\u3044").addText(e=>e.setPlaceholder("API\u30AD\u30FC\u3092\u5165\u529B").setValue(this.plugin.settings.apiKey).onChange(async i=>{this.plugin.settings.apiKey=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("\u30E2\u30C7\u30EB").setDesc("\u4F7F\u7528\u3059\u308BGemini\u30E2\u30C7\u30EB\u3092\u9078\u629E").addDropdown(e=>e.addOption("gemini-2.0-flash","Gemini 2.0 Flash").addOption("gemini-2.5-flash-preview-05-20","Gemini 2.5 Flash Preview 05-20").addOption("gemini-2.5-pro-preview-05-06","Gemini 2.5 Pro Preview 05-06").setValue(this.plugin.settings.model).onChange(async i=>{this.plugin.settings.model=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("\u7FFB\u8A33\u5148\u8A00\u8A9E").setDesc("\u7FFB\u8A33\u5148\u306E\u8A00\u8A9E\u3092\u6307\u5B9A").addText(e=>e.setPlaceholder("\u4F8B: \u65E5\u672C\u8A9E").setValue(this.plugin.settings.targetLanguage).onChange(async i=>{this.plugin.settings.targetLanguage=i,await this.plugin.saveSettings()}))}};
